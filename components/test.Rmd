---
title: "401HW8"
author: "Iris Miao"
date: "Due November 19, 2021 (3:00pm)"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

2.
```{r}
library(ggplot2)
data = read.csv(file = "/Users/isaac/Downloads/SAheart.csv",head=TRUE)
data = data[-1]
data = data.frame(data)
```

a)
```{r}
plot(data)
```

From the pairs plot, it seems like tobacco has a positive correlation with adiposity, typea, and age. It has a negative relationship with ldl and alcohol. Obesity seems to have the strongest positive relationship with adiposity and negative relationship with alcohol. Age seems to have a positive relationship with all variables while alcohol has a negative relationship with all variables but typea. Famhist and chd are clearly categorical variables with 2 levels which makes visualization on a pairs plot difficult. We will further explore the relationship in the remaining sections. 

b) 
```{r}
reg <- glm(chd ~., data=data)
summary(reg)
resid <- rstudent(reg)
plot(reg)
abline(h=0)
```


From the logistic regression output, we see that tobacco, ldl, famhistPresent, typea, and age have a pvalue of <0.05. This suggests we do not have enough evidence to reject the null hypothesis that these variables are significant predictors of chd. Looking at the residual plots, we see that the residuals are not randomly scattered about the h=0 line which suggests that the linearity and homoscedasticity assumptions are violated. Also, from the QQ plot, the points deviate from the normal line which suggests the normality/guassian assumption is violated.

c) 
```{r}
a = seq(15, 64, 1)
psi = numeric(length(a))
X = subset(data, select=-c(chd, age))
for(i in 15:64){
  newdata = data.frame(X, age=rep.int(i, dim(X)[1]))
  p = predict(reg, newdata = newdata)
  psi[i - 14] = sum(p)/dim(X)[1]
}
plot(a, psi)
```

d)
```{r}
X = subset(data, select=-c(chd, age))
Y = subset(data, select=chd)
A = subset(data, select=age)
n = dim(Y)[1]
a = seq(15, 64, 1)
l = numeric(length(a))
u = numeric(length(a))
psi.matrix = matrix(nrow = 1000, ncol = length(a))

for(i in 1:1000){
  I = sample(1:n, size=n, replace=TRUE)
  XX = X[I, ]
  YY = Y[I, ]
  AA = A[I, ]
  for(j in 15:64) {
    newdata = data.frame(XX, age=rep.int(j,n))
    p = predict(reg, newdata = newdata)
    psi.matrix[[i, j - 14]]=sum(p)/n
  }
}

for(i in 1:length(a)) {
  col = psi.matrix[, i]
  quant = quantile(col, c(.025,.975))
  l[i] = q[1]
  u[i] = q[2]
}
plot(a, psi, ylab = "psi")
points(a, l, col="red")
points(a, u, col="blue")
```




























